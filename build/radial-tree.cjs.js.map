{"version":3,"file":"radial-tree.cjs.js","sources":["../src/js/processing/timemap.js","../src/js/index.js"],"sourcesContent":["import _ from 'lodash';\n\n\n/**\n * Process timemap data from endpoint /web/timemap/json to the inner format\n *\n * @param url\n * @param data\n * @returns {*}\n */\nexport function processTimeMapData(url, data) {\n  let regexHTTP = /http:\\/\\//;\n  let regexHTTPS = /https:\\/\\//;\n  let regexLast = /\\/$/;\n  url.replace(regexHTTP, '');\n  url.replace(regexHTTPS, '');\n  url.replace(regexLast, '');\n\n  if (data.length === 0) {\n    return {\n      allYears: [],\n      yearData: [],\n    };\n  }\n\n  let yearUrl = [];\n  for (let i = 1; i < data.length; i++) {\n    if (data[i][1].match(/jpg|pdf|png|form|gif/)) {\n      continue;\n    }\n    data[i][1] = data[i][1].trim().replace(':80/', '/');\n    if (data[i][0] in yearUrl) {\n      yearUrl[data[i][0]].push(data[i][1]);\n    } else {\n      yearUrl[data[i][0]] = [data[i][1]];\n    }\n  }\n  let ret = [];\n  for (let year in yearUrl) {\n    ret.push([year].concat(yearUrl[year]));\n  }\n  /** ret has the following format:\n   *  array(\n   *    array(2005, url1, url2, .... urlN),\n   *    ...\n   *  ) **/\n  let years = (function () {\n    for (let i = 0; i < ret.length; i++) {\n      let urls = [];\n\n      for (let j = 1; j < ret[i].length; j++) {\n        let url;\n        if (ret[i][j].includes('http')) {\n          url = ret[i][j].substring(7);\n        } else if (ret[i][j].includes('https')) {\n          url = ret[i][j].substring(8);\n        }\n        if (url.includes('//')) {\n          url = url.split('//').join('/');\n        }\n        url = url.split('/').join('/');\n        urls.push(url);\n      }\n\n      urls = _.uniq(urls.sort());\n\n      //year should be the 1st\n      urls.unshift(ret[i][0]);\n\n      ret[i] = urls;\n    }\n    return ret;\n  }());\n\n  let all_years = years.map(function (year) {\n    if (year.length > 1) {\n      return year[0];\n    }\n  });\n\n  return {\n    allYears: all_years,\n    yearData: years,\n  };\n}\n","import * as d3 from 'd3';\nimport {processTimeMapData} from './processing/timemap';\n\n/**\n *\n * Radial Tree Library\n *\n * @param {DOMElement} element\n @ @param {Array} cdx_data: decoded CDX Query data retrieved by:\n ``/web/timemap/json?url=example.com/&fl=timestamp:4,original&matchType=prefix\n &filter=statuscode:200&filter=mimetype:text/html&collapse=urlkey\n &collapse=timestamp:4&limit=100000``.\n * @param {Object} option\n * Option baseURL defines the target Wayback Machine server.\n *\n */\nexport function RadialTree(element, cdx_data, option) {\n  let GlobYear = 0;\n  let baseURL = 'https://web.archive.org';\n  // Use typeof check to allow empty string in baseURL value\n  if (typeof option.baseURL !== 'undefined') {\n    baseURL = option.baseURL;\n  }\n  if (!option.url) return;\n\n  init(element);\n\n  let {allYears, yearData} = processTimeMapData(option.url, cdx_data);\n\n  createYearButtons(element, option, allYears, yearData);\n\n  function init(container) {\n    let content = document.createElement('div');\n    content.setAttribute('class', 'rt-content');\n    let divBtn = document.createElement('div');\n    divBtn.setAttribute('class', 'div-btn');\n\n    let sequence = document.createElement('p');\n    sequence.setAttribute('class', 'sequence');\n    let chart = document.createElement('div');\n    chart.setAttribute('id', 'chart');\n    content.appendChild(divBtn);\n    content.appendChild(sequence);\n    content.appendChild(chart);\n    content.style.display = 'block';\n\n    container.appendChild(content);\n  }\n\n  function createYearButtons(element, option, allYears, yearData) {\n    let divBtn = element.querySelector('.div-btn');\n    if (!element.querySelector('.year-btn')) {\n      allYears.forEach(function (year, i) {\n        let btn = document.createElement('button');\n        btn.setAttribute('class', 'year-btn');\n        btn.setAttribute('id', allYears[i]);\n        btn.innerHTML = allYears[i];\n        btn.onclick = function (evt) {\n          let target = evt.target;\n          if (element.querySelector('.active-btn')) {\n            element.querySelector('.active-btn').classList.remove('active-btn');\n          }\n          target.classList.add('active-btn');\n          GlobYear = target.id;\n          let num = allYears.indexOf(target.id);\n          let text = makeNewText(num, yearData);\n          drawChart(element, option, text);\n        };\n        divBtn.appendChild(btn);\n        // highlight the 2nd last year if available, else hightlight the last.\n        // necessary because the last year may not have much data.\n        if(allYears.length >= 2) {\n          if (i === allYears.length - 2) btn.click();\n        } else {\n          if (i === allYears.length - 1) btn.click();\n        }\n      });\n    }\n  }\n\n  function drawChart(element, option, text) {\n    element.querySelector('.sequence').innerHTML = '';\n    element.querySelector('#chart').innerHTML = '';\n    const width = element.querySelector('#chart').offsetWidth;\n    const height = width;\n    const radius = Math.min(width, height) / 2;\n    let colors = d3.scaleOrdinal(d3.schemeCategory20b);\n    let vis = d3.select('#chart')\n      .append('svg:svg')\n      .attr('width', width)\n      .attr('height', height)\n      .append('svg:g')\n      .attr('id', 'd3_container')\n      .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n    let partition = d3.partition()\n      .size([2 * Math.PI, radius * radius]);\n    let arc = d3.arc()\n      .startAngle(function (d) {\n        return d.x0;\n      })\n      .endAngle(function (d) {\n        return d.x1;\n      })\n      .innerRadius(function (d) {\n        return Math.sqrt(d.y0);\n      })\n      .outerRadius(function (d) {\n        return Math.sqrt(d.y1);\n      });\n\n    let csv = d3.csvParseRows(text);\n    let json = buildHierarchy(csv);\n    createVisualization(json);\n\n    function createVisualization(json) {\n      vis.append('svg:circle')\n        .attr('r', radius)\n        .style('opacity', 0);\n      let root = d3.hierarchy(json)\n        .sum(function (d) {\n          return d.size;\n        })\n        .sort(function (a, b) {\n          return b.value - a.value;\n        });\n      let nodes = partition(root)\n        .descendants();\n\n      vis.data([json])\n        .selectAll('path')\n        .data(nodes)\n        .enter()\n        .append('a')\n        .attr('xlink:href', currentUrl)\n        .on('touchstart', touchStart)\n        .append('svg:path')\n        .attr('display', function (d) {\n          return d.depth ? null : 'none';\n        })\n        .attr('d', arc)\n        .attr('fill-rule', 'evenodd')\n        .style('fill', function (d) {\n          if (d.data.name === 'end') {\n            return '#000000';\n          } else {\n            return colors((d.children ? d : d.parent).data.name);\n          }\n        })\n        .style('opacity', 1)\n        .style('cursor', 'pointer')\n        .on('mouseover', mouseover);\n\n      d3.select('#d3_container')\n        .on('mouseleave', mouseleave);\n    }\n\n    /** on mobile devices, touching the RadialTree prevents the ``click``\n     *  event and shows the URL like on ``mouseover`` event. Users can click\n     *  on the URL to visit the target page */\n    function touchStart(d) {\n      d3.event.preventDefault();\n      d3.event.stopPropagation();\n      mouseover(d);\n      return false;\n    }\n\n    function currentUrl(d) {\n      const anc = d.ancestors().reverse();\n      let url = '';\n      for (let i = 1; i < anc.length; i++) {\n        if (anc[i].data.name === 'end') {\n          break;\n        }\n        url = url + '/' + anc[i].data.name;\n      }\n      return `${baseURL}/web/${GlobYear}0630${url}`;\n    }\n\n    function mouseover(d) {\n      let sequenceArray = d.ancestors().reverse();\n      sequenceArray.shift();\n      let url = currentUrl(d);\n      updateBreadcrumbs(sequenceArray, url);\n      d3.selectAll('path').style('opacity', 0.3);\n      vis.selectAll('path').filter(function (node) {\n        return (sequenceArray.indexOf(node) >= 0);\n      }).style('opacity', 1);\n    }\n\n    function mouseleave() {\n      element.querySelector('.sequence').innerHTML = '';\n      d3.selectAll('path').on('mouseover', null);\n      d3.selectAll('path').transition().style('opacity', 1).on('end', function () {\n        d3.select(this).on('mouseover', mouseover);\n      });\n    }\n\n    function updateBreadcrumbs(nodeArray, url) {\n      let text = '';\n      let symb = document.createElement('span');\n      symb.setAttribute('class', 'symb');\n      symb.innerHTML = '/';\n      for (let i = 0; i < nodeArray.length; i++) {\n        if (i === 0) {\n          text = ' ' + nodeArray[i].data.name;\n        } else {\n          text = text + symb.innerHTML + nodeArray[i].data.name;\n        }\n      }\n      text = decodeURIComponent(text);\n      element.querySelector('.sequence').innerHTML = `<a href=\"${url}\">${text}</a>`;\n    }\n\n    function buildHierarchy(csv) {\n      csv.sort(function (a, b) {\n        return a[0].length - b[0].length || a[0].localeCompare(b[0]);\n      });\n      let real_urls = {};\n      real_urls[option.url] = 1;\n      if (option.url.slice(-1) !== '/') {\n        real_urls[option.url + '/'] = 1;\n      }\n      for (let i = 0; i < csv.length; i++) {\n        let key = String(csv[i][0]).trim().replace(':80/', '/');\n        real_urls[key] = 1;\n        if (key.slice(-1) !== '/') {\n          real_urls[key + '/'] = 1;\n        }\n      }\n\n      let DELIMITER = '|';\n\n      function filterRealUrl(url) {\n        let parts = url.trim().split('/');\n        let delimiter_index = [];\n        for (let i = 1; i < parts.length; i++) {\n          let potentialUrl = parts.slice(0, i).join('/');\n          if (potentialUrl in real_urls === false && i > 0) {\n            let pos = parts.slice(0, i).join('/').length;\n            delimiter_index.push(pos);\n          }\n        }\n        if (delimiter_index.length > 0) {\n          let result_url = url;\n          for (let j = 1; j < delimiter_index.length; j++) {\n            let index = delimiter_index[j];\n            result_url = result_url.substr(0, index) + DELIMITER + result_url.substr(index + 1);\n          }\n          return result_url;\n        }\n        return url;\n      }\n\n      let root = {name: 'root', children: []};\n      for (let i = 0; i < csv.length; i++) {\n        let sequence = filterRealUrl(csv[i][0]);\n        let size = +csv[i][1];\n        if (isNaN(size)) {\n          continue;\n        }\n        let parts = sequence.split('/');\n        parts = parts.map(function (s) {\n          return s.replace(/\\|/g, '/');\n        });\n        let currentNode = root;\n        for (let j = 0; j < parts.length; j++) {\n          let children = currentNode.children;\n          let nodeName = parts[j];\n          let childNode;\n          if (j + 1 < parts.length) {\n            let foundChild = false;\n            for (let k = 0; k < children.length; k++) {\n              if (children[k].name === nodeName) {\n                childNode = children[k];\n                foundChild = true;\n                break;\n              }\n            }\n            if (!foundChild) {\n              childNode = {name: nodeName, children: []};\n              children.push(childNode);\n            }\n            currentNode = childNode;\n          } else {\n            childNode = {name: nodeName, size: size};\n            children.push(childNode);\n          }\n        }\n      }\n      return root;\n    }\n  }\n\n  function makeNewText(n, yearData) {\n    let text = '';\n    let x = 2;\n    if (yearData[n].length === 2) {\n      x = 1;\n    }\n    for (let i = x; i < yearData[n].length; i++) {\n      if (i !== (yearData[n].length - 1)) {\n        text = text + yearData[n][i] + ' ,1' + '\\n';\n      } else {\n        text = text + yearData[n][i] + ' ,1';\n      }\n    }\n    return text;\n  }\n}\n"],"names":["processTimeMapData","url","data","regexHTTP","regexHTTPS","regexLast","replace","length","yearUrl","i","match","trim","push","ret","year","concat","years","urls","j","includes","substring","split","join","_","uniq","sort","unshift","all_years","map","RadialTree","element","cdx_data","option","GlobYear","baseURL","allYears","yearData","init","container","content","document","createElement","setAttribute","divBtn","sequence","chart","appendChild","style","display","createYearButtons","querySelector","forEach","btn","innerHTML","onclick","evt","target","classList","remove","add","id","num","indexOf","text","makeNewText","click","drawChart","width","offsetWidth","height","radius","Math","min","colors","d3","vis","append","attr","partition","size","PI","arc","startAngle","d","x0","endAngle","x1","innerRadius","sqrt","y0","outerRadius","y1","csv","json","buildHierarchy","createVisualization","root","sum","a","b","value","nodes","descendants","selectAll","enter","currentUrl","on","touchStart","depth","name","children","parent","mouseover","mouseleave","preventDefault","stopPropagation","anc","ancestors","reverse","sequenceArray","shift","filter","node","transition","updateBreadcrumbs","nodeArray","symb","decodeURIComponent","localeCompare","real_urls","slice","key","String","DELIMITER","filterRealUrl","parts","delimiter_index","potentialUrl","pos","result_url","index","substr","isNaN","s","currentNode","nodeName","childNode","foundChild","k","n","x"],"mappings":"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"}